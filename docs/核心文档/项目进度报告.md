# ğŸ“Š Jaaz é¡¹ç›®è¿›åº¦æŠ¥å‘Š

> **æ›´æ–°æ—¶é—´**: 2025-11-13
> **é¡¹ç›®ç‰ˆæœ¬**: v1.0.30
> **ä»£ç åº“è§„æ¨¡**: çº¦ 50,000+ è¡Œä»£ç  (356 æ–‡ä»¶)

---

## ğŸ“ˆ é¡¹ç›®æ¦‚å†µ

### åŸºæœ¬ä¿¡æ¯

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **Python æ–‡ä»¶** | 153 ä¸ª |
| **TypeScript/TSX æ–‡ä»¶** | 203 ä¸ª |
| **API è·¯ç”±** | 23 ä¸ª |
| **AI å·¥å…·** | 22 ä¸ª (16å›¾åƒ + 6è§†é¢‘) |
| **AI Provider** | 8 ä¸ª |
| **æ•°æ®åº“è¿ç§»ç‰ˆæœ¬** | v7 (v8 å¾…å®æ–½) |
| **æ”¯æŒè¯­è¨€** | 3 ç§ (ä¸­è‹±ç¹) |

### æŠ€æœ¯æ ˆ

**å‰ç«¯ (Electron + React)**
- React 19.1.0 + Vite
- Excalidraw (ç”»å¸ƒå¼•æ“)
- Zustand (çŠ¶æ€ç®¡ç†)
- Socket.IO Client (å®æ—¶é€šä¿¡)
- TanStack Query + Router
- i18next (å›½é™…åŒ–)

**åç«¯ (Python + FastAPI)**
- FastAPI + Uvicorn
- LangGraph 0.4.8 (å¤šæ™ºèƒ½ä½“)
- SQLite + aiosqlite (å¼‚æ­¥æ•°æ®åº“)
- Socket.IO (WebSocket æœåŠ¡)
- psd-tools (PSD æ–‡ä»¶è§£æ)
- google-genai (Gemini API)

**AI é›†æˆ**
- Google Gemini 2.5 Flash (æ–‡æœ¬ + å›¾åƒ)
- OpenAI GPT-4o / DALL-E
- Midjourney (via Jaaz API)
- ComfyUI (æœ¬åœ° Stable Diffusion)
- ç«å±±å¼•æ“ (è±†åŒ… Seedream/Seedance)
- Replicate (å¼€æºæ¨¡å‹æ‰˜ç®¡)

---

## âœ… å·²å®ŒæˆåŠŸèƒ½ (å®Œæˆåº¦: 80%)

### 1. æ ¸å¿ƒç”»å¸ƒåŠŸèƒ½ âœ… 100%

**çŠ¶æ€**: å®Œå…¨å®ç°ï¼Œç”Ÿäº§å¯ç”¨

**åŠŸèƒ½æ¸…å•**:

- âœ… æ— é™ç”»å¸ƒç¼–è¾‘ (Excalidraw å¼•æ“)
- âœ… å¤šç§å…ƒç´ æ”¯æŒ (æ–‡æœ¬/å›¾ç‰‡/å½¢çŠ¶/ç®­å¤´/æ‰‹ç»˜)
- âœ… å›¾å±‚ç®¡ç† (åˆ›å»º/åˆ é™¤/é‡å‘½å/æ’åº)
- âœ… ç”»å¸ƒ CRUD (åˆ›å»º/è¯»å–/æ›´æ–°/åˆ é™¤)
- âœ… æƒé™æ§åˆ¶ (æ¸¸å®¢åªè¯» / ç”¨æˆ·ç¼–è¾‘ / ç®¡ç†å‘˜å…¨æƒ)
- âœ… å®æ—¶ä¿å­˜ (WebSocket åŒæ­¥)
- âœ… å¯¼å‡ºåŠŸèƒ½ (PNG/SVG/JSON)

**å…³é”®æ–‡ä»¶**:
- `react/src/components/canvas/CanvasExcali.tsx` - ç”»å¸ƒæ ¸å¿ƒ
- `react/src/components/canvas/PSDLayerSidebar.tsx` - å›¾å±‚é¢æ¿
- `server/routers/canvas.py` - ç”»å¸ƒ API

**æŠ€æœ¯äº®ç‚¹**:
- Excalidraw åä½œç¼–è¾‘æ”¯æŒ
- å›¾å±‚æ™ºèƒ½æ’ç‰ˆ (Gemini Vision API)
- æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡/PSD æ–‡ä»¶

---

### 2. AI å¯¹è¯ç³»ç»Ÿ âœ… 90%

**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œä¼˜åŒ–ä¸­

**æ¶æ„**: LangGraph å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

```
ç”¨æˆ·è¾“å…¥
  â†“
Planner Agent (è§„åˆ’å™¨)
  â”œâ”€ åˆ†æä»»åŠ¡ç±»å‹
  â”œâ”€ é€‰æ‹©åˆé€‚çš„å·¥å…·
  â””â”€ åˆ‡æ¢åˆ°ä¸“ç”¨ Agent
       â†“
Image/Video Creator Agent
  â”œâ”€ è°ƒç”¨å›¾åƒç”Ÿæˆå·¥å…·
  â”œâ”€ è°ƒç”¨è§†é¢‘ç”Ÿæˆå·¥å…·
  â””â”€ è¿”å›ç»“æœåˆ°ç”»å¸ƒ
```

**å®ç°ç»†èŠ‚**:

- âœ… è‡ªåŠ¨æ¨¡å‹åˆ‡æ¢ (OpenAI â†’ Gemini é™çº§)
- âœ… æµå¼è¾“å‡º (å®æ—¶åé¦ˆç”Ÿæˆè¿›åº¦)
- âœ… ä¸Šä¸‹æ–‡ç®¡ç† (å®Œæ•´å¯¹è¯å†å²)
- âœ… å·¥å…·è°ƒç”¨ (22 ä¸ª AI å·¥å…·è‡ªåŠ¨é€‰æ‹©)
- âš ï¸ é”™è¯¯é‡è¯•æœºåˆ¶ (éƒ¨åˆ†å®ç°)

**å…³é”®æ–‡ä»¶**:
- `server/services/langgraph_service/agent_service.py` - LangGraph æ‰§è¡Œå¼•æ“
- `server/services/langgraph_service/agent_manager.py` - æ™ºèƒ½ä½“å·¥å‚
- `server/services/chat_service.py` - å¯¹è¯æœåŠ¡å…¥å£

**å¾…ä¼˜åŒ–**:
- [ ] Planner æ¨¡å‹ç”¨æˆ·å¯é€‰ (å½“å‰å¼ºåˆ¶ Gemini)
- [ ] å·¥å…·è°ƒç”¨ç«æ€æ¡ä»¶ä¿®å¤
- [ ] æ›´æ™ºèƒ½çš„ä»»åŠ¡åˆ†è§£

---

### 3. å›¾åƒç”Ÿæˆ âœ… 95%

**çŠ¶æ€**: ç”Ÿäº§å¯ç”¨ï¼Œæ¨¡å‹ä¸°å¯Œ

**æ”¯æŒæ¨¡å‹ (16 ä¸ª)**:

| æ¨¡å‹ | Provider | çŠ¶æ€ |
|------|---------|------|
| Gemini 2.5 Flash | Google AI | âœ… å·²é›†æˆ |
| GPT-4o Image | OpenAI | âœ… å·²é›†æˆ |
| Midjourney | Jaaz API | âœ… å·²é›†æˆ |
| Imagen 4 | Google/Replicate | âœ… å·²é›†æˆ |
| Flux Kontext Pro/Max | Jaaz/Replicate | âœ… å·²é›†æˆ |
| Recraft v3 | Jaaz/Replicate | âœ… å·²é›†æˆ |
| Ideogram 3 | Jaaz API | âœ… å·²é›†æˆ |
| è±†åŒ… Seedream 3 | ç«å±±å¼•æ“ | âœ… å·²é›†æˆ |

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… Text-to-Image (æ–‡æœ¬ç”Ÿæˆå›¾åƒ)
- âœ… Image-to-Image (å›¾åƒé£æ ¼è½¬æ¢)
- âœ… å¤šç§å®½é«˜æ¯” (1:1, 16:9, 9:16, 4:3, 3:4)
- âœ… è‡ªåŠ¨ä¿å­˜åˆ°ç”»å¸ƒ
- âœ… ç”Ÿæˆè¿›åº¦å®æ—¶åé¦ˆ
- âœ… æ‰¹é‡ç”Ÿæˆæ”¯æŒ

**å…³é”®ä»£ç **:
```python
# server/tools/generate_image_by_gemini_2_5_flash.py
@tool
async def generate_image_by_gemini_2_5_flash(
    prompt: str,
    aspect_ratio: str = "1:1",
    config: RunnableConfig,
) -> str:
    # è°ƒç”¨ GeminiImageProvider
    return await generate_image_with_provider(
        provider='gemini',
        model='gemini-2.5-flash-image',
        prompt=prompt,
        aspect_ratio=aspect_ratio,
    )
```

**æœ€æ–°è¿›å±•**:
- âœ… Gemini å›¾åƒç”Ÿæˆå®Œå…¨é›†æˆ (2025-11-13)
- âœ… ä»£ç†é…ç½®æ”¯æŒ (ä¸­å›½å¤§é™†è®¿é—® Google API)
- âœ… ç«¯å£åŒæ­¥ä¿®å¤ (å›¾ç‰‡ URL æ­£ç¡®ç”Ÿæˆ)

---

### 4. è§†é¢‘ç”Ÿæˆ âœ… 85%

**çŠ¶æ€**: åŠŸèƒ½å¯ç”¨ï¼Œå‰ç«¯å±•ç¤ºå¾…å®Œå–„

**æ”¯æŒæ¨¡å‹ (6 ä¸ª)**:

| æ¨¡å‹ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|
| Seedance v1 Pro | T2V + I2V | âœ… å·²é›†æˆ |
| Kling v2 | é•¿è§†é¢‘ç”Ÿæˆ | âœ… å·²é›†æˆ |
| æµ·èºè§†é¢‘ 02 | é«˜è´¨é‡è§†é¢‘ | âœ… å·²é›†æˆ |
| VEO 3 Fast | å¿«é€Ÿè§†é¢‘ç”Ÿæˆ | âœ… å·²é›†æˆ |

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… Text-to-Video (æ–‡æœ¬ç”Ÿæˆè§†é¢‘)
- âœ… Image-to-Video (å›¾ç‰‡è½¬è§†é¢‘)
- âœ… è§†é¢‘å…ƒç´ åµŒå…¥ç”»å¸ƒ
- âš ï¸ è§†é¢‘ç¼–è¾‘å™¨ (ä»…åŸºç¡€åŠŸèƒ½)

**å¾…å®Œå–„**:
- [ ] è§†é¢‘å‰ªè¾‘åŠŸèƒ½
- [ ] è§†é¢‘è½¬åœºæ•ˆæœ
- [ ] éŸ³é¢‘è½¨é“æ”¯æŒ

---

### 5. PSD æ–‡ä»¶å¤„ç† âœ… 100%

**çŠ¶æ€**: å®Œå…¨å®ç°ï¼Œç”Ÿäº§ç¨³å®š

**åŠŸèƒ½æ¸…å•**:
- âœ… PSD æ–‡ä»¶ä¸Šä¼ 
- âœ… å›¾å±‚è§£æå’Œæå–
- âœ… å›¾å±‚æ ‘å±•ç¤º (å¸¦ç¼©ç•¥å›¾)
- âœ… å•ä¸ªå›¾å±‚å¯¼å‡º
- âœ… æ–‡æœ¬å›¾å±‚ç¼–è¾‘
- âœ… å­—ä½“ä¿¡æ¯æå–
- âœ… å…ƒæ•°æ®è¯»å– (å°ºå¯¸/é¢œè‰²æ¨¡å¼)

**å…³é”®æ–‡ä»¶**:
- `server/routers/psd_router.py` - PSD API (57KB)
- `server/tools/psd_tools` åº“
- `react/src/components/psd/PSDEditor.tsx` - PSD ç¼–è¾‘å™¨

**æŠ€æœ¯äº®ç‚¹**:
```python
# å›¾å±‚æå–æ”¯æŒé€æ˜åº¦å’Œæ··åˆæ¨¡å¼
layer_image = layer.topil(channel=-1)  # åŒ…å« alpha é€šé“
```

---

### 6. ç”¨æˆ·è®¤è¯ âœ… 100%

**çŠ¶æ€**: ä¼ä¸šçº§åŠŸèƒ½å®Œæ•´

**è®¤è¯æ–¹å¼**:
1. **æœ¬åœ°è´¦å·å¯†ç ** (bcrypt åŠ å¯†)
2. **Google OAuth 2.0**
   - è®¾å¤‡ç æµç¨‹ (Device Code Flow)
   - æˆæƒç æµç¨‹ (Authorization Code Flow)
3. **Token è®¤è¯** (Bearer Token)

**æƒé™ç³»ç»Ÿ**:
| è§’è‰² | æƒé™ |
|------|------|
| **æ¸¸å®¢** | åªè¯»ç”»å¸ƒ / ä¸èƒ½ä¸‹è½½æ¨¡æ¿ |
| **æ™®é€šç”¨æˆ·** | åˆ›å»º/ç¼–è¾‘è‡ªå·±çš„ç”»å¸ƒ / ä¸‹è½½æ¨¡æ¿ |
| **ç®¡ç†å‘˜** | å…¨éƒ¨æƒé™ / ç”¨æˆ·ç®¡ç† / ç»„ç»‡ç®¡ç† |

**å…³é”®ä»£ç **:
```python
# ä¾èµ–æ³¨å…¥å®ç°æƒé™æ§åˆ¶
async def get_current_user_optional(authorization: str = Header(None)):
    """æ¸¸å®¢å’Œç™»å½•ç”¨æˆ·å…±ç”¨ä¸€ä¸ªç«¯ç‚¹"""
    if not authorization:
        return None  # æ¸¸å®¢èº«ä»½
    return await auth_service.verify_token(token)
```

**æ•°æ®åº“è¡¨**:
- `users` - ç”¨æˆ·ä¿¡æ¯ (v4 è¿ç§»)
- `google_auth` å­—æ®µ (v5 è¿ç§»)
- `role` å­—æ®µ (v7 è¿ç§»)

---

### 7. WebSocket å®æ—¶é€šä¿¡ âœ… 90%

**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½ç¨³å®šï¼Œéœ€ä¼˜åŒ–

**åŠŸèƒ½**:
- âœ… AI ç”Ÿæˆè¿›åº¦æ¨é€
- âœ… å·¥å…·è°ƒç”¨çŠ¶æ€æ›´æ–°
- âœ… èŠå¤©æ¶ˆæ¯å®æ—¶åŒæ­¥
- âœ… ç”»å¸ƒåä½œç¼–è¾‘ (Excalidraw)
- âš ï¸ æ¶ˆæ¯éš”ç¦» (ç¼ºå°‘ canvas_id è¿‡æ»¤)

**æ¶æ„**:
```
å‰ç«¯ (Socket.IO Client)
  â†• WebSocket
åç«¯ (Socket.IO Server)
  â†•
LangGraph StreamProcessor
  â†•
AI Provider (Gemini/OpenAI/...)
```

**äº‹ä»¶ç±»å‹**:
- `image_generated` - å›¾åƒç”Ÿæˆå®Œæˆ
- `video_generated` - è§†é¢‘ç”Ÿæˆå®Œæˆ
- `tool_call` - å·¥å…·è°ƒç”¨å¼€å§‹/ç»“æŸ
- `agent_thinking` - AI æ€è€ƒè¿‡ç¨‹
- `error` - é”™è¯¯ä¿¡æ¯

**å¾…ä¼˜åŒ–**:
```python
# TODO: All Broadcast should have a canvas_id
# å½“å‰æ‰€æœ‰ç”¨æˆ·ä¼šæ”¶åˆ°åŒä¸€æ¡æ¶ˆæ¯ï¼Œéœ€è¦æŒ‰ç”»å¸ƒéš”ç¦»
```

---

### 8. ç®¡ç†å‘˜é¢æ¿ âœ… 95%

**çŠ¶æ€**: åŠŸèƒ½å®Œæ•´ï¼ŒUI å¾…ç¾åŒ–

**åŠŸèƒ½æ¨¡å—**:

- âœ… ç”¨æˆ·ç®¡ç† (CRUD / è§’è‰²åˆ†é…)
- âœ… ç»„ç»‡ç®¡ç† (åˆ›å»º/åˆ é™¤ç»„ç»‡)
- âœ… ç§¯åˆ†ç®¡ç† (å……å€¼/æ‰£è´¹/æŸ¥è¯¢)
- âœ… ä½¿ç”¨ç»Ÿè®¡ (API è°ƒç”¨é‡/è´¹ç”¨)
- âœ… ç³»ç»Ÿç›‘æ§ (å¥åº·æ£€æŸ¥/æ—¥å¿—)

**API å‰ç¼€**: `/api/admin/*`

**å…³é”®æ–‡ä»¶**:
- `server/routers/manager_route.py` - ç®¡ç†å‘˜ API (26KB)
- `server/services/manager_service.py` - ç®¡ç†æœåŠ¡
- `react/src/routes/admin.tsx` - ç®¡ç†å‘˜å‰ç«¯

---

### 9. ComfyUI é›†æˆ âœ… 85%

**çŠ¶æ€**: æœ¬åœ°éƒ¨ç½²å¯ç”¨ï¼Œè‡ªåŠ¨åŒ–å¾…å®Œå–„

**åŠŸèƒ½**:
- âœ… ComfyUI è‡ªåŠ¨ä¸‹è½½å’Œå®‰è£…
- âœ… è¿›ç¨‹ç®¡ç† (å¯åŠ¨/åœæ­¢)
- âœ… å·¥ä½œæµæ‰§è¡Œ (WebSocket)
- âœ… è‡ªå®šä¹‰èŠ‚ç‚¹æ”¯æŒ
- âš ï¸ é”™è¯¯å¤„ç† (éƒ¨åˆ†åœºæ™¯å´©æºƒ)

**ä¾èµ–**:
- Electron ä¸»è¿›ç¨‹ç®¡ç† ComfyUI å­è¿›ç¨‹
- WebSocket è¿æ¥ `ws://127.0.0.1:8188`

**å…³é”®æ–‡ä»¶**:
- `electron/comfyUIManager.js` - ComfyUI ç®¡ç†å™¨
- `server/routers/comfyui_execution.py` - å·¥ä½œæµæ‰§è¡Œ
- `server/tools/image_providers/comfyui_provider.py`

---

### 10. å›½é™…åŒ– âœ… 100%

**çŠ¶æ€**: å®Œå…¨å®ç°ï¼Œç¿»è¯‘å®Œæ•´

**æ”¯æŒè¯­è¨€**:
- ğŸ‡ºğŸ‡¸ è‹±æ–‡ (English)
- ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡
- ğŸ‡¹ğŸ‡¼ ç¹ä½“ä¸­æ–‡

**ç¿»è¯‘æ–‡ä»¶**:

- `react/src/i18n/locales/en/*.json`
- `react/src/i18n/locales/zh-CN/*.json`
- `react/src/i18n/locales/zh-TW/*.json`

**ä½¿ç”¨æ–¹å¼**:
```typescript
import { useTranslation } from 'react-i18next'
const { t } = useTranslation()

<Button>{t('canvas.create')}</Button>
```

---

## ğŸ—„ï¸ æ•°æ®åº“ç°çŠ¶

### æ•°æ®åº“åˆå§‹åŒ– âœ… å®Œå…¨è‡ªåŠ¨åŒ–

**æ•°æ®åº“æ–‡ä»¶**: `server/user_data/localmanus.db` (8.8 MB)

**è‡ªåŠ¨è¿ç§»ç³»ç»Ÿ**:
- âœ… å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æ•°æ®åº“ç‰ˆæœ¬
- âœ… è‡ªåŠ¨æ‰§è¡Œå¢é‡è¿ç§» (v0 â†’ v7)
- âœ… åˆ›å»ºå¿…è¦çš„è¡¨å’Œç´¢å¼•
- âœ… æ’å…¥é»˜è®¤æ•°æ®

**å·²å®æ–½çš„è¿ç§»** (v1-v7):
1. **v1**: èŠå¤©ä¼šè¯å’Œæ¶ˆæ¯è¡¨
2. **v2**: ç”»å¸ƒè¡¨ + é»˜è®¤ç”»å¸ƒ
3. **v3**: ComfyUI å·¥ä½œæµè¡¨
4. **v4**: ç”¨æˆ·è®¤è¯è¡¨ (users, device_codes, auth_tokens)
5. **v5**: Google OAuth å­—æ®µ
6. **v6**: ç”»å¸ƒç”¨æˆ·å…³è”
7. **v7**: ç”¨æˆ·è§’è‰²å­—æ®µ (admin/editor/viewer)

**æ•°æ®åº“è¡¨ç»“æ„**:
```
localmanus.db
â”œâ”€â”€ db_version          # æ•°æ®åº“ç‰ˆæœ¬å·
â”œâ”€â”€ chat_sessions       # èŠå¤©ä¼šè¯ (å…³è” canvas_id)
â”œâ”€â”€ chat_messages       # èŠå¤©æ¶ˆæ¯ (JSON æ ¼å¼)
â”œâ”€â”€ canvases            # ç”»å¸ƒæ•°æ® (å…³è” user_id)
â”œâ”€â”€ comfy_workflows     # ComfyUI å·¥ä½œæµ
â”œâ”€â”€ users               # ç”¨æˆ·è¡¨ (æ”¯æŒæœ¬åœ°+Googleç™»å½•)
â”œâ”€â”€ device_codes        # Google OAuth è®¾å¤‡ç 
â””â”€â”€ auth_tokens         # è®¤è¯ä»¤ç‰Œ (TODO: è¿ç§»åˆ° Redis)
```

**è¯¦ç»†åˆ†æ**: å‚è§ [æ•°æ®åº“ç°çŠ¶åˆ†æ.md](./æ•°æ®åº“ç°çŠ¶åˆ†æ.md)

---

### æ•°æ®å†™å…¥åŠŸèƒ½ âœ… 80% å®Œæˆ

**å·²å®ç°çš„å†™å…¥æ“ä½œ**:

1. **ç”»å¸ƒç®¡ç†** âœ… 100%
   - åˆ›å»ºç”»å¸ƒ (`create_canvas`)
   - ä¿å­˜ç”»å¸ƒæ•°æ® (`save_canvas_data`)
   - é‡å‘½åç”»å¸ƒ (`rename_canvas`)
   - åˆ é™¤ç”»å¸ƒ (`delete_canvas`)

2. **èŠå¤©ä¼šè¯** âœ… 100%
   - åˆ›å»ºä¼šè¯ (`create_chat_session`)
   - ä¿å­˜æ¶ˆæ¯ (`create_message`)
   - è·å–å†å² (`get_chat_history`)

3. **ç”¨æˆ·è®¤è¯** âœ… 100%
   - åˆ›å»ºç”¨æˆ· (`create_user`)
   - åˆ›å»º Token (`create_token`)
   - åˆ›å»ºè®¾å¤‡ç  (`create_device_code`)
   - Google OAuth ç”¨æˆ·åˆ›å»º (`create_or_update_google_user`)

4. **ComfyUI å·¥ä½œæµ** âœ… 100%
   - åˆ›å»ºå·¥ä½œæµ (`create_comfy_workflow`)
   - åˆ é™¤å·¥ä½œæµ (`delete_comfy_workflow`)

**æœªå®ç°çš„å†™å…¥æ“ä½œ**:
- âŒ æ¨¡æ¿ç®¡ç† (templates è¡¨ä¸å­˜åœ¨ï¼Œv8 è¿ç§»æœªå®æ–½)

---

### å‰åç«¯è”è°ƒçŠ¶æ€ âœ… 90% æ­£å¸¸

**âœ… å®Œå…¨æ­£å¸¸çš„æ¥å£**:

1. **ç”»å¸ƒæ¥å£** âœ… 100%
   ```
   GET  /api/canvases          # åˆ—å‡ºç”»å¸ƒ
   POST /api/canvases          # åˆ›å»ºç”»å¸ƒ
   GET  /api/canvases/{id}     # è·å–ç”»å¸ƒ
   PUT  /api/canvases/{id}     # ä¿å­˜ç”»å¸ƒ
   DELETE /api/canvases/{id}   # åˆ é™¤ç”»å¸ƒ
   ```
   - å‰ç«¯ React Query æŸ¥è¯¢æ­£å¸¸
   - æ•°æ®åº“è¯»å†™æ­£å¸¸
   - æƒé™æ§åˆ¶æ­£å¸¸ (ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„ç”»å¸ƒ)

2. **èŠå¤©æ¥å£** âœ… 100%
   ```
   WebSocket: 'chat' äº‹ä»¶    # å‘é€æ¶ˆæ¯
   WebSocket: 'message' äº‹ä»¶  # æ¥æ”¶å“åº”
   ```
   - WebSocket åŒå‘é€šä¿¡æ­£å¸¸
   - æ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ âœ…
   - LangGraph è°ƒç”¨æ­£å¸¸
   - æµå¼è¾“å‡ºæ­£å¸¸

3. **ç”¨æˆ·è®¤è¯æ¥å£** âœ… 100%
   ```
   POST /api/auth/register       # æ³¨å†Œ
   POST /api/auth/login          # ç™»å½•
   POST /api/auth/google/device  # Google OAuth
   GET  /api/auth/user           # è·å–ç”¨æˆ·ä¿¡æ¯
   ```
   - æœ¬åœ°è´¦å·ç™»å½• âœ…
   - Google OAuth ç™»å½• âœ…
   - Token è®¤è¯ âœ…
   - æƒé™ä¾èµ–æ³¨å…¥ âœ…

**âš ï¸ éƒ¨åˆ†æ­£å¸¸çš„æ¥å£**:

1. **æ¨¡æ¿æ¥å£** âš ï¸ 50%
   ```
   GET /api/templates  # è¿”å›ç©ºåˆ—è¡¨ï¼Œä¸æŠ¥é”™
   ```
   - æ¥å£å“åº”æ­£å¸¸ âœ…
   - ä½†æ— æ³•åˆ›å»º/ç¼–è¾‘æ¨¡æ¿ âŒ
   - åŸå› : templates è¡¨ä¸å­˜åœ¨

**æµ‹è¯•æ–¹æ³•**:
```typescript
// å‰ç«¯æµ‹è¯•ç”»å¸ƒåˆ—è¡¨
const { data: canvases } = useQuery({
  queryKey: ['canvases'],
  queryFn: listCanvases,
})

// å¦‚æœè¿”å›æ•°æ® â†’ æ•°æ®åº“è¿æ¥æ­£å¸¸ âœ…
```

---

## ğŸ—„ï¸ æ•°æ®åº“ç°çŠ¶

### æ•°æ®åº“åˆå§‹åŒ– âœ… å®Œå…¨è‡ªåŠ¨åŒ–

**æ•°æ®åº“æ–‡ä»¶**: `server/user_data/localmanus.db` (8.8 MB)

**è‡ªåŠ¨è¿ç§»ç³»ç»Ÿ**:
- âœ… å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æ•°æ®åº“ç‰ˆæœ¬
- âœ… è‡ªåŠ¨æ‰§è¡Œå¢é‡è¿ç§» (v0 â†’ v7)
- âœ… åˆ›å»ºå¿…è¦çš„è¡¨å’Œç´¢å¼•
- âœ… æ’å…¥é»˜è®¤æ•°æ®

**å·²å®æ–½çš„è¿ç§»** (v1-v7):
1. **v1**: èŠå¤©ä¼šè¯å’Œæ¶ˆæ¯è¡¨
2. **v2**: ç”»å¸ƒè¡¨ + é»˜è®¤ç”»å¸ƒ
3. **v3**: ComfyUI å·¥ä½œæµè¡¨
4. **v4**: ç”¨æˆ·è®¤è¯è¡¨ (users, device_codes, auth_tokens)
5. **v5**: Google OAuth å­—æ®µ
6. **v6**: ç”»å¸ƒç”¨æˆ·å…³è”
7. **v7**: ç”¨æˆ·è§’è‰²å­—æ®µ (admin/editor/viewer)

**æ•°æ®åº“è¡¨ç»“æ„**:
```
localmanus.db
â”œâ”€â”€ db_version          # æ•°æ®åº“ç‰ˆæœ¬å·
â”œâ”€â”€ chat_sessions       # èŠå¤©ä¼šè¯ (å…³è” canvas_id)
â”œâ”€â”€ chat_messages       # èŠå¤©æ¶ˆæ¯ (JSON æ ¼å¼)
â”œâ”€â”€ canvases            # ç”»å¸ƒæ•°æ® (å…³è” user_id)
â”œâ”€â”€ comfy_workflows     # ComfyUI å·¥ä½œæµ
â”œâ”€â”€ users               # ç”¨æˆ·è¡¨ (æ”¯æŒæœ¬åœ°+Googleç™»å½•)
â”œâ”€â”€ device_codes        # Google OAuth è®¾å¤‡ç 
â””â”€â”€ auth_tokens         # è®¤è¯ä»¤ç‰Œ (TODO: è¿ç§»åˆ° Redis)
```

**è¯¦ç»†åˆ†æ**: å‚è§ [æ•°æ®åº“ç°çŠ¶åˆ†æ.md](./æ•°æ®åº“ç°çŠ¶åˆ†æ.md)

---

### æ•°æ®å†™å…¥åŠŸèƒ½ âœ… 80% å®Œæˆ

**å·²å®ç°çš„å†™å…¥æ“ä½œ**:

1. **ç”»å¸ƒç®¡ç†** âœ… 100%
   - åˆ›å»ºç”»å¸ƒ (`create_canvas`)
   - ä¿å­˜ç”»å¸ƒæ•°æ® (`save_canvas_data`)
   - é‡å‘½åç”»å¸ƒ (`rename_canvas`)
   - åˆ é™¤ç”»å¸ƒ (`delete_canvas`)

2. **èŠå¤©ä¼šè¯** âœ… 100%
   - åˆ›å»ºä¼šè¯ (`create_chat_session`)
   - ä¿å­˜æ¶ˆæ¯ (`create_message`)
   - è·å–å†å² (`get_chat_history`)

3. **ç”¨æˆ·è®¤è¯** âœ… 100%
   - åˆ›å»ºç”¨æˆ· (`create_user`)
   - åˆ›å»º Token (`create_token`)
   - åˆ›å»ºè®¾å¤‡ç  (`create_device_code`)
   - Google OAuth ç”¨æˆ·åˆ›å»º (`create_or_update_google_user`)

4. **ComfyUI å·¥ä½œæµ** âœ… 100%
   - åˆ›å»ºå·¥ä½œæµ (`create_comfy_workflow`)
   - åˆ é™¤å·¥ä½œæµ (`delete_comfy_workflow`)

**æœªå®ç°çš„å†™å…¥æ“ä½œ**:
- âŒ æ¨¡æ¿ç®¡ç† (templates è¡¨ä¸å­˜åœ¨ï¼Œv8 è¿ç§»æœªå®æ–½)

---

### å‰åç«¯è”è°ƒçŠ¶æ€ âœ… 90% æ­£å¸¸

**âœ… å®Œå…¨æ­£å¸¸çš„æ¥å£**:

1. **ç”»å¸ƒæ¥å£** âœ… 100%
   ```
   GET  /api/canvases          # åˆ—å‡ºç”»å¸ƒ
   POST /api/canvases          # åˆ›å»ºç”»å¸ƒ
   GET  /api/canvases/{id}     # è·å–ç”»å¸ƒ
   PUT  /api/canvases/{id}     # ä¿å­˜ç”»å¸ƒ
   DELETE /api/canvases/{id}   # åˆ é™¤ç”»å¸ƒ
   ```
   - å‰ç«¯ React Query æŸ¥è¯¢æ­£å¸¸
   - æ•°æ®åº“è¯»å†™æ­£å¸¸
   - æƒé™æ§åˆ¶æ­£å¸¸ (ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„ç”»å¸ƒ)

2. **èŠå¤©æ¥å£** âœ… 100%
   ```
   WebSocket: 'chat' äº‹ä»¶    # å‘é€æ¶ˆæ¯
   WebSocket: 'message' äº‹ä»¶  # æ¥æ”¶å“åº”
   ```
   - WebSocket åŒå‘é€šä¿¡æ­£å¸¸
   - æ¶ˆæ¯æŒä¹…åŒ–åˆ°æ•°æ®åº“ âœ…
   - LangGraph è°ƒç”¨æ­£å¸¸
   - æµå¼è¾“å‡ºæ­£å¸¸

3. **ç”¨æˆ·è®¤è¯æ¥å£** âœ… 100%
   ```
   POST /api/auth/register       # æ³¨å†Œ
   POST /api/auth/login          # ç™»å½•
   POST /api/auth/google/device  # Google OAuth
   GET  /api/auth/user           # è·å–ç”¨æˆ·ä¿¡æ¯
   ```
   - æœ¬åœ°è´¦å·ç™»å½• âœ…
   - Google OAuth ç™»å½• âœ…
   - Token è®¤è¯ âœ…
   - æƒé™ä¾èµ–æ³¨å…¥ âœ…

**âš ï¸ éƒ¨åˆ†æ­£å¸¸çš„æ¥å£**:

1. **æ¨¡æ¿æ¥å£** âš ï¸ 50%
   ```
   GET /api/templates  # è¿”å›ç©ºåˆ—è¡¨ï¼Œä¸æŠ¥é”™
   ```
   - æ¥å£å“åº”æ­£å¸¸ âœ…
   - ä½†æ— æ³•åˆ›å»º/ç¼–è¾‘æ¨¡æ¿ âŒ
   - åŸå› : templates è¡¨ä¸å­˜åœ¨

**æµ‹è¯•æ–¹æ³•**:
```typescript
// å‰ç«¯æµ‹è¯•ç”»å¸ƒåˆ—è¡¨
const { data: canvases } = useQuery({
  queryKey: ['canvases'],
  queryFn: listCanvases,
})

// å¦‚æœè¿”å›æ•°æ® â†’ æ•°æ®åº“è¿æ¥æ­£å¸¸ âœ…
```

---

## âš ï¸ éƒ¨åˆ†å®ç°åŠŸèƒ½ (å®Œæˆåº¦: 40%)

### 1. æ¨¡æ¿ç³»ç»Ÿ âš ï¸ 40%

**çŠ¶æ€**: å‰ç«¯ UI å®Œæ•´ï¼Œåç«¯æ•°æ®åº“è¡¨ç¼ºå¤±

**æ•°æ®åº“ç°çŠ¶**:
- âœ… ç‹¬ç«‹çš„ `templates.db` æ–‡ä»¶å­˜åœ¨ (28 KB)
- âŒ ä¸»æ•°æ®åº“ `localmanus.db` ä¸­æ—  `templates` è¡¨
- âŒ v8 è¿ç§»æ–‡ä»¶ä¸å­˜åœ¨ (`v8_create_templates_table.py`)

**æ•°æ®åº“ç°çŠ¶**:
- âœ… ç‹¬ç«‹çš„ `templates.db` æ–‡ä»¶å­˜åœ¨ (28 KB)
- âŒ ä¸»æ•°æ®åº“ `localmanus.db` ä¸­æ—  `templates` è¡¨
- âŒ v8 è¿ç§»æ–‡ä»¶ä¸å­˜åœ¨ (`v8_create_templates_table.py`)

**é—®é¢˜æè¿°**:
```python
# server/routers/template_router.py
# TODO: [æ•°æ®åº“è¿ç§»] ä¸´æ—¶ç¦ç”¨æ¨¡æ¿åŠŸèƒ½
# åŸå› : templates è¡¨å°šæœªåˆ›å»ºï¼ˆéœ€è¦ v8_create_templates_table.py è¿ç§»æ–‡ä»¶ï¼‰
return []  # æ‰€æœ‰ç«¯ç‚¹è¿”å›ç©ºåˆ—è¡¨æˆ– 503 é”™è¯¯
```

**å‰ç«¯å½±å“**:
- æ¨¡æ¿é¡µé¢æ˜¾ç¤ºç©ºåˆ—è¡¨
- åˆ›å»º/ç¼–è¾‘/åˆ é™¤æŒ‰é’®æ— æ•ˆ
- ä¸å½±å“å…¶ä»–åŠŸèƒ½ (Gemini å›¾ç‰‡ç”Ÿæˆæ­£å¸¸)

**ä¿®å¤æ­¥éª¤**:
1. åˆ›å»º `server/services/migrations/v8_create_templates_table.py`
2. åœ¨ `manager.py` ä¸­å–æ¶ˆæ³¨é‡Š `V8CreateTemplatesTable`
3. å°† `CURRENT_VERSION` æ”¹ä¸º 8
4. å–æ¶ˆ `template_router.py` ä»£ç æ³¨é‡Š

**é¢„è®¡å·¥ä½œé‡**: 1-2 å°æ—¶

---

### 2. æ™ºèƒ½æ’ç‰ˆ âš ï¸ 60%

**çŠ¶æ€**: Gemini Vision API é›†æˆï¼Œç®—æ³•å¾…ä¼˜åŒ–

**å½“å‰å®ç°**:
- âœ… è‡ªåŠ¨åˆ†æç”»å¸ƒå†…å®¹
- âœ… è°ƒæ•´å›¾å±‚ä½ç½®
- âš ï¸ æ’ç‰ˆæ•ˆæœä¸ç¨³å®š

**å¾…ä¼˜åŒ–**:
- [ ] å¯¹é½ç®—æ³•ä¼˜åŒ–
- [ ] é—´è·è‡ªåŠ¨è°ƒæ•´
- [ ] å“åº”å¼å¸ƒå±€æ”¯æŒ

---

### 3. å­—ä½“ç®¡ç† âš ï¸ 70%

**çŠ¶æ€**: åŸºç¡€åŠŸèƒ½å¯ç”¨ï¼Œé«˜çº§åŠŸèƒ½ç¼ºå¤±

**å·²å®ç°**:
- âœ… ç³»ç»Ÿå­—ä½“æ‰«æ
- âœ… è‡ªå®šä¹‰å­—ä½“ä¸Šä¼ 
- âœ… å­—ä½“é¢„è§ˆ

**å¾…å®Œå–„**:
- [ ] å­—ä½“åˆ†ç±»ç®¡ç†
- [ ] Google Fonts é›†æˆ
- [ ] å­—ä½“å˜ä½“æ”¯æŒ (ç²—ä½“/æ–œä½“)

---

## âŒ å¾…å®ç°åŠŸèƒ½

### 1. è§†é¢‘ç¼–è¾‘å™¨ âŒ 10%

**å½“å‰çŠ¶æ€**: ä»…æ”¯æŒåµŒå…¥è§†é¢‘å…ƒç´ åˆ°ç”»å¸ƒ

**ç¼ºå¤±åŠŸèƒ½**:
- [ ] æ—¶é—´è½´ç¼–è¾‘
- [ ] è§†é¢‘å‰ªè¾‘
- [ ] è½¬åœºæ•ˆæœ
- [ ] éŸ³é¢‘è½¨é“
- [ ] å­—å¹•æ”¯æŒ

**æŠ€æœ¯æ–¹æ¡ˆ**: è€ƒè™‘é›†æˆ FFmpeg.js

---

### 2. åä½œç¼–è¾‘ âŒ 30%

**å½“å‰çŠ¶æ€**: Excalidraw æ”¯æŒåä½œï¼Œåç«¯æœªå®ç°

**ç¼ºå¤±åŠŸèƒ½**:
- [ ] å¤šç”¨æˆ·å®æ—¶ç¼–è¾‘
- [ ] å†²çªè§£å†³
- [ ] æ“ä½œå†å²
- [ ] ç‰ˆæœ¬æ§åˆ¶

---

### 3. æ’ä»¶ç³»ç»Ÿ âŒ 0%

**è§„åˆ’ä¸­çš„åŠŸèƒ½**:
- [ ] ç¬¬ä¸‰æ–¹æ’ä»¶å®‰è£…
- [ ] è‡ªå®šä¹‰å·¥å…·å¼€å‘
- [ ] æ’ä»¶å¸‚åœº

---

## ğŸ› å·²çŸ¥é—®é¢˜å’ŒæŠ€æœ¯å€ºåŠ¡

### é«˜ä¼˜å…ˆçº§ (P0)

#### 1. å·¥å…·æœåŠ¡ç«æ€æ¡ä»¶
**ä½ç½®**: `server/services/tool_service.py:228`
```python
# TODO: Check if there will be racing conditions when server just
# starting up but tools are not ready yet.
```
**å½±å“**: æœåŠ¡å¯åŠ¨æ—¶ç”¨æˆ·å‘é€èŠå¤©è¯·æ±‚å¯èƒ½å´©æºƒ

**ä¿®å¤æ–¹æ¡ˆ**: æ·»åŠ åˆå§‹åŒ–å®Œæˆæ ‡å¿—
```python
tools_ready = asyncio.Event()

async def initialize_tools():
    # ... åŠ è½½å·¥å…·
    tools_ready.set()

@router.post("/chat")
async def chat():
    await tools_ready.wait()  # ç­‰å¾…å·¥å…·åˆå§‹åŒ–å®Œæˆ
```

---

#### 2. æ¨¡æ¿åŠŸèƒ½ç¦ç”¨
**å½±å“èŒƒå›´**: å‰ç«¯æ¨¡æ¿é¡µé¢å®Œå…¨ä¸å¯ç”¨

**ä¿®å¤**: åˆ›å»º v8 æ•°æ®åº“è¿ç§»æ–‡ä»¶ (è§ä¸Šæ–‡)

---

### ä¸­ä¼˜å…ˆçº§ (P1)

#### 3. WebSocket æ¶ˆæ¯éš”ç¦»
**ä½ç½®**: `server/services/websocket_service.py:22`
```python
# TODO: All Broadcast should have a canvas_id
```
**é—®é¢˜**: æ‰€æœ‰ç”¨æˆ·æ”¶åˆ°ç›¸åŒçš„ WebSocket æ¶ˆæ¯

**ä¿®å¤æ–¹æ¡ˆ**:
```python
async def broadcast(canvas_id: str, message: dict):
    # åªå‘è®¢é˜…è¯¥ç”»å¸ƒçš„ç”¨æˆ·å‘é€æ¶ˆæ¯
    for sid in canvas_subscriptions.get(canvas_id, []):
        await sio.emit('message', message, room=sid)
```

---

#### 4. Gemini Token é™åˆ¶
**ä½ç½®**: `server/services/langgraph_service/agent_service.py:173`
```python
# TODO: Verify if max_tokens is working
# max_tokens=max_tokens,  # æš‚æ—¶æ³¨é‡Šæ‰æœ‰é—®é¢˜çš„å‚æ•°
```
**é—®é¢˜**: æ— æ³•æ§åˆ¶ Gemini è¾“å‡ºé•¿åº¦

---

#### 5. æµ‹è¯•ä½™é¢ç¡¬ç¼–ç 
**ä½ç½®**: `react/src/hooks/use-balance.ts`
```typescript
// ä¸´æ—¶ä¿®æ”¹ï¼šæµ‹è¯•æ¨¡å‹ç”Ÿæˆæ—¶è¿”å›å¤§ä½™é¢ï¼Œé¿å…ç§¯åˆ†ä¸è¶³æç¤º
return { balance: 999.00 }
```
**å½±å“**: ç”Ÿäº§ç¯å¢ƒéœ€è¦æ¢å¤çœŸå®ä½™é¢æŸ¥è¯¢

---

### ä½ä¼˜å…ˆçº§ (P2)

#### 6. è°ƒè¯•æ—¥å¿—è¿‡å¤š
**ä½ç½®**: å…¨å±€ 50+ å¤„
```python
logger.debug(f"...")  # å¾…ç§»é™¤
console.debug('...')  # å¾…ç§»é™¤
```

---

#### 7. Token å­˜å‚¨ä¼˜åŒ–
**ä½ç½®**: `server/supabase_schema.sql:57`
```sql
-- TODOï¼šåç»­å¯ä»¥çš„è¯è½¬redis
```
**å»ºè®®**: SQLite â†’ Redis (é«˜å¹¶å‘åœºæ™¯)

---

## ğŸ“… é¡¹ç›®é‡Œç¨‹ç¢‘

### âœ… å·²å®Œæˆé‡Œç¨‹ç¢‘

| æ—¥æœŸ | é‡Œç¨‹ç¢‘ | è¯´æ˜ |
|------|--------|------|
| 2025-11-12 | v1.0.0 å‘å¸ƒ | æ ¸å¿ƒç”»å¸ƒåŠŸèƒ½ä¸Šçº¿ |
| 2025-11-13 | Gemini é›†æˆ | å›¾åƒç”Ÿæˆå®Œå…¨å¯ç”¨ |
| 2025-11-13 | æ–‡æ¡£å®Œå–„ | é¡¹ç›®æ–‡æ¡£ä½“ç³»å»ºç«‹ |

### ğŸ¯ è®¡åˆ’ä¸­é‡Œç¨‹ç¢‘

| æ—¥æœŸ | é‡Œç¨‹ç¢‘ | çŠ¶æ€ |
|------|--------|------|
| 2025-11-14 | v1.0.31 | ğŸ”„ å¼€å‘ä¸­ (æ¨¡æ¿åŠŸèƒ½ä¿®å¤) |
| 2025-11-20 | v1.1.0 | ğŸ“‹ è§„åˆ’ä¸­ (è§†é¢‘ç¼–è¾‘å™¨) |
| 2025-12-01 | v1.2.0 | ğŸ“‹ è§„åˆ’ä¸­ (åä½œç¼–è¾‘) |

---

## ğŸ’¡ é¡¹ç›®äº®ç‚¹

### 1. å…ˆè¿›çš„å¤šæ™ºèƒ½ä½“æ¶æ„
- LangGraph Swarm å®ç°æ™ºèƒ½ä½“åä½œ
- Planner + Creator åˆ†å·¥æ˜ç¡®
- è‡ªåŠ¨ä»»åŠ¡åˆ†è§£å’Œå·¥å…·é€‰æ‹©

### 2. ä¸°å¯Œçš„ AI æ¨¡å‹æ”¯æŒ
- 22 ä¸ªå›¾åƒ/è§†é¢‘ç”Ÿæˆå·¥å…·
- 8 ä¸ª Provider æŠ½è±¡å±‚
- ä¸€é”®åˆ‡æ¢æ¨¡å‹ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 

### 3. éšç§ä¼˜å…ˆè®¾è®¡
- æœ¬åœ°éƒ¨ç½²æ”¯æŒ (Ollama + ComfyUI)
- æ•°æ®ä¸ä¸Šä¼ äº‘ç«¯
- ä¼ä¸šçº§æƒé™æ§åˆ¶

### 4. è·¨å¹³å°æ”¯æŒ
- Windows / macOS / Linux
- Electron æ¡Œé¢åº”ç”¨
- Web ç‰ˆæœ¬ Docker éƒ¨ç½²

---

## ğŸ“Š ä»£ç è´¨é‡

### æµ‹è¯•è¦†ç›–ç‡
- **å‰ç«¯**: <5% (å‡ ä¹æ— æµ‹è¯•)
- **åç«¯**: <10% (å°‘é‡å•å…ƒæµ‹è¯•)
- **å»ºè®®**: æå‡åˆ° 60%+ (æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆ)

### ä»£ç è§„èŒƒ
- âœ… Python: Black Formatter
- âœ… TypeScript: ESLint + Prettier
- âš ï¸ æ³¨é‡Šè¦†ç›–ç‡: çº¦ 30%

### æ€§èƒ½æŒ‡æ ‡
- ç”»å¸ƒåŠ è½½æ—¶é—´: < 1 ç§’
- å›¾åƒç”Ÿæˆæ—¶é—´: 5-30 ç§’ (å–å†³äºæ¨¡å‹)
- WebSocket å»¶è¿Ÿ: < 100ms

---

## ğŸ¯ ä¸‹ä¸€æ­¥å·¥ä½œ

è§ [é¡¹ç›®è§„åˆ’.md](./é¡¹ç›®è§„åˆ’.md)

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-11-13*

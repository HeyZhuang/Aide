# ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Jaaz é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œä»£ç ç»„ç»‡æ–¹å¼ã€‚

---

## ğŸŒ³ ç›®å½•æ ‘

```
psd-canvas-jaaz/
â”œâ”€â”€ electron/              # Electron ä¸»è¿›ç¨‹ä»£ç 
â”‚   â”œâ”€â”€ main.js           # Electron å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ preload.js        # é¢„åŠ è½½è„šæœ¬
â”‚   â””â”€â”€ dist/             # TypeScript ç¼–è¯‘è¾“å‡º
â”‚
â”œâ”€â”€ react/                # React å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/   # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/        # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ pages/        # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ stores/       # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ App.tsx       # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ public/           # é™æ€èµ„æº
â”‚   â”œâ”€â”€ dist/             # æ„å»ºè¾“å‡º
â”‚   â””â”€â”€ package.json      # å‰ç«¯ä¾èµ–
â”‚
â”œâ”€â”€ server/               # Python åç«¯ä»£ç 
â”‚   â”œâ”€â”€ main.py           # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ common.py         # å…¬å…±é…ç½®
â”‚   â”œâ”€â”€ requirements.txt  # Python ä¾èµ–
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/          # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ chat_router.py          # å¯¹è¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ image_router.py         # å›¾ç‰‡ä¸Šä¼ /ä¸‹è½½
â”‚   â”‚   â”œâ”€â”€ canvas.py               # ç”»å¸ƒæ“ä½œ
â”‚   â”‚   â”œâ”€â”€ template_router.py      # æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth_router.py          # ç”¨æˆ·è®¤è¯
â”‚   â”‚   â””â”€â”€ manager_route.py        # ç®¡ç†å‘˜æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ chat_service.py         # å¯¹è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ config_service.py       # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ db_service.py           # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ tool_service.py         # AI å·¥å…·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ template_service.py     # æ¨¡æ¿æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ websocket_service.py    # WebSocket æœåŠ¡
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ langgraph_service/      # LangGraph å¤šæ™ºèƒ½ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ agent_service.py    # æ™ºèƒ½ä½“ç¼–æ’
â”‚   â”‚   â”‚   â”œâ”€â”€ agent_manager.py    # æ™ºèƒ½ä½“ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ StreamProcessor.py  # æµå¼å¤„ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ migrations/             # æ•°æ®åº“è¿ç§»
â”‚   â”‚       â”œâ”€â”€ manager.py          # è¿ç§»ç®¡ç†å™¨
â”‚   â”‚       â”œâ”€â”€ v1_initial_schema.py
â”‚   â”‚       â”œâ”€â”€ v2_add_canvases.py
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/            # LangChain å·¥å…·
â”‚   â”‚   â”œâ”€â”€ generate_image_by_gemini_2_5_flash.py
â”‚   â”‚   â”œâ”€â”€ generate_image_by_midjourney_jaaz.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ image_providers/        # å›¾åƒç”Ÿæˆæä¾›å•†
â”‚   â”‚   â”‚   â”œâ”€â”€ image_base_provider.py  # åŸºç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_provider.py      # Gemini å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ openai_provider.py      # OpenAI å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ replicate_provider.py   # Replicate å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ jaaz_provider.py        # Jaaz API å®ç°
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/                  # å·¥å…·è¾…åŠ©å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ image_generation_core.py   # å›¾åƒç”Ÿæˆæ ¸å¿ƒ
â”‚   â”‚       â”œâ”€â”€ image_canvas_utils.py      # ç”»å¸ƒå·¥å…·
â”‚   â”‚       â””â”€â”€ image_utils.py             # å›¾åƒå¤„ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ tool_model.py           # å·¥å…·æ¨¡å‹
â”‚   â”‚   â””â”€â”€ config_model.py         # é…ç½®æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/            # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ logger.py               # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ canvas.py               # ç”»å¸ƒå·¥å…·
â”‚   â”‚   â””â”€â”€ permission_dependency.py # æƒé™éªŒè¯
â”‚   â”‚
â”‚   â”œâ”€â”€ user_data/        # ç”¨æˆ·æ•°æ®ç›®å½•
â”‚   â”‚   â”œâ”€â”€ config.toml             # ç”¨æˆ·é…ç½®
â”‚   â”‚   â”œâ”€â”€ localmanus.db           # SQLite æ•°æ®åº“
â”‚   â”‚   â””â”€â”€ files/                  # ç”Ÿæˆçš„æ–‡ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ tests/            # æµ‹è¯•æ–‡ä»¶
â”‚
â”œâ”€â”€ tests/                # PowerShell æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test_gemini_with_monitoring.ps1
â”‚   â””â”€â”€ start_server_with_proxy.ps1
â”‚
â”œâ”€â”€ docs/                 # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                   # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ PROJECT_OVERVIEW.md         # é¡¹ç›®ä»‹ç»
â”‚   â”œâ”€â”€ PROJECT_STRUCTURE.md        # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ GIT_COMMIT_GUIDE.md         # Git è§„èŒƒ
â”‚   â”œâ”€â”€ DOCKER_DEPLOYMENT.md        # Docker éƒ¨ç½²
â”‚   â””â”€â”€ GEMINI_SETUP.md             # Gemini é…ç½®
â”‚
â”œâ”€â”€ assets/               # èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ icons/            # åº”ç”¨å›¾æ ‡
â”‚
â”œâ”€â”€ package.json          # æ ¹ç›®å½• Node ä¾èµ–
â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
â””â”€â”€ .gitignore            # Git å¿½ç•¥é…ç½®
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. Electron ä¸»è¿›ç¨‹ (`electron/`)

**èŒè´£**ï¼š
- åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†
- çª—å£åˆ›å»ºå’Œç®¡ç†
- ç³»ç»Ÿçº§åŠŸèƒ½é›†æˆ
- å‰åç«¯è¿›ç¨‹é€šä¿¡

**å…³é”®æ–‡ä»¶**ï¼š
- `main.js` - åº”ç”¨å…¥å£ï¼Œåˆ›å»ºçª—å£
- `preload.js` - å®‰å…¨çš„ IPC é€šä¿¡æ¡¥æ¥

---

### 2. React å‰ç«¯ (`react/`)

**èŒè´£**ï¼š
- ç”¨æˆ·ç•Œé¢æ¸²æŸ“
- ç”¨æˆ·äº¤äº’å¤„ç†
- ç”»å¸ƒç¼–è¾‘åŠŸèƒ½
- WebSocket å®æ—¶é€šä¿¡

**ç›®å½•ç»“æ„**ï¼š
```
src/
â”œâ”€â”€ components/         # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ Canvas/        # ç”»å¸ƒç»„ä»¶
â”‚   â”œâ”€â”€ Chat/          # å¯¹è¯ç»„ä»¶
â”‚   â””â”€â”€ Template/      # æ¨¡æ¿ç»„ä»¶
â”œâ”€â”€ pages/             # é¡µé¢çº§ç»„ä»¶
â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ use-balance.ts    # ä½™é¢æŸ¥è¯¢
â”‚   â””â”€â”€ use-websocket.ts  # WebSocket è¿æ¥
â”œâ”€â”€ stores/            # Zustand çŠ¶æ€ç®¡ç†
â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
```

---

### 3. Python åç«¯ (`server/`)

#### 3.1 è·¯ç”±å±‚ (`routers/`)

| æ–‡ä»¶ | è·¯ç”±å‰ç¼€ | åŠŸèƒ½ |
|------|----------|------|
| `chat_router.py` | `/api/chat` | å¯¹è¯æ¥å£ |
| `image_router.py` | `/api/file` | å›¾ç‰‡ä¸Šä¼ /ä¸‹è½½ |
| `canvas.py` | `/api/canvas` | ç”»å¸ƒCRUD |
| `template_router.py` | `/api/templates` | æ¨¡æ¿ç®¡ç† |
| `auth_router.py` | `/api/auth` | ç”¨æˆ·è®¤è¯ |
| `manager_route.py` | `/api/admin` | ç®¡ç†å‘˜åŠŸèƒ½ |

#### 3.2 æœåŠ¡å±‚ (`services/`)

**æ ¸å¿ƒæœåŠ¡**ï¼š

- **chat_service.py** - å¤„ç†å¯¹è¯è¯·æ±‚ï¼Œè°ƒç”¨ LangGraph
- **config_service.py** - ç®¡ç† AI æ¨¡å‹é…ç½®
- **db_service.py** - æ•°æ®åº“æ“ä½œå°è£…
- **websocket_service.py** - WebSocket æ¶ˆæ¯æ¨é€

**LangGraph æœåŠ¡** (`langgraph_service/`):

- **agent_service.py** - å¤šæ™ºèƒ½ä½“ç¼–æ’å…¥å£
- **agent_manager.py** - æ™ºèƒ½ä½“åˆ›å»ºå’Œç®¡ç†
- **StreamProcessor.py** - æµå¼å“åº”å¤„ç†

#### 3.3 å·¥å…·å±‚ (`tools/`)

**LangChain å·¥å…·**ï¼š
- æ¯ä¸ªå·¥å…·æ˜¯ä¸€ä¸ª LangChain Tool
- å·¥å…·åç§°æ ¼å¼ï¼š`generate_image_by_{model}_jaaz`
- è‡ªåŠ¨æ³¨å†Œåˆ° `tool_service.py`

**Provider æ¨¡å¼** (`image_providers/`):
- ç»Ÿä¸€æ¥å£æŠ½è±¡ä¸åŒ AI æœåŠ¡
- æ‰€æœ‰ Provider ç»§æ‰¿ `ImageBaseProvider`
- æ”¯æŒçƒ­æ’æ‹”æ–°çš„ AI æœåŠ¡

#### 3.4 æ•°æ®å±‚ (`user_data/`)

**é…ç½®æ–‡ä»¶** (`config.toml`):
```toml
[gemini]
url = "https://generativelanguage.googleapis.com/v1beta"
api_key = "AIza..."

[gemini.models."gemini-2.5-flash"]
type = "text"

[gemini.models."gemini-2.5-flash-image"]
type = "image"
```

**æ•°æ®åº“** (`localmanus.db`):
- SQLite æœ¬åœ°æ•°æ®åº“
- è¡¨ï¼šusers, canvases, chat_sessions, templates ç­‰
- è‡ªåŠ¨è¿ç§»ç®¡ç†

---

## ğŸ”„ æ•°æ®æµå‘

### å›¾ç‰‡ç”Ÿæˆæµç¨‹

```
ç”¨æˆ·è¾“å…¥: "ç”»ä¸€å¼ å°ç‹—å›¾ç‰‡"
    â†“
React å‰ç«¯ â†’ WebSocket â†’ /api/chat
    â†“
chat_service.py â†’ langgraph_multi_agent()
    â†“
LangGraph Planner æ™ºèƒ½ä½“ â†’ åˆ†æä»»åŠ¡
    â†“
è‡ªåŠ¨åˆ‡æ¢åˆ° Image Creator æ™ºèƒ½ä½“
    â†“
è°ƒç”¨å·¥å…·: generate_image_by_gemini_2_5_flash
    â†“
GeminiImageProvider.generate()
    â†“
è°ƒç”¨ Google Gemini API
    â†“
ä¿å­˜å›¾ç‰‡åˆ° user_data/files/
    â†“
save_image_to_canvas() â†’ æ›´æ–°æ•°æ®åº“
    â†“
WebSocket æ¨é€: 'image_generated' äº‹ä»¶
    â†“
React å‰ç«¯ â†’ æ›´æ–°ç”»å¸ƒæ˜¾ç¤º
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### `package.json` (æ ¹ç›®å½•)

```json
{
  "name": "jaaz",
  "version": "1.0.30",
  "main": "electron/main.js",
  "scripts": {
    "dev": "åŒæ—¶å¯åŠ¨ React å’Œ Electron",
    "build:win": "æ‰“åŒ… Windows ç‰ˆæœ¬",
    "build:mac": "æ‰“åŒ… macOS ç‰ˆæœ¬"
  }
}
```

### `requirements.txt` (Python ä¾èµ–)

```txt
fastapi              # Web æ¡†æ¶
uvicorn[standard]    # ASGI æœåŠ¡å™¨
langchain            # AI ç¼–æ’
langgraph            # å¤šæ™ºèƒ½ä½“
aiosqlite            # å¼‚æ­¥æ•°æ®åº“
python-socketio      # WebSocket
```

---

## ğŸ“ å‘½åè§„èŒƒ

### Python ä»£ç 

- **æ–‡ä»¶å**: `snake_case.py`
- **ç±»å**: `PascalCase`
- **å‡½æ•°å**: `snake_case()`
- **å¸¸é‡**: `UPPER_SNAKE_CASE`

### TypeScript/React ä»£ç 

- **æ–‡ä»¶å**: `kebab-case.tsx` æˆ– `PascalCase.tsx`
- **ç»„ä»¶å**: `PascalCase`
- **å‡½æ•°å**: `camelCase()`
- **å¸¸é‡**: `UPPER_SNAKE_CASE`

---

## ğŸš€ æ¨¡å—ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Routers   â”‚ â† è·¯ç”±å±‚ï¼ˆæ¥æ”¶ HTTP è¯·æ±‚ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Services   â”‚ â† ä¸šåŠ¡é€»è¾‘å±‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Tools    â”‚ â† å·¥å…·å±‚ï¼ˆLangChain Toolsï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Providers  â”‚ â† æä¾›å•†å±‚ï¼ˆAI æœåŠ¡å°è£…ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ External AI â”‚ â† å¤–éƒ¨ AI æœåŠ¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*æœ€åæ›´æ–°ï¼š2025-11-13*
